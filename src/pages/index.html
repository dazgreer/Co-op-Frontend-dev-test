<!DOCTYPE html>
<html class="no-js" lang="en">
<head>

	<!-- Is JS supported? -->
	<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
  
 	<meta charset="utf-8">
	<title>Co-op Digital | Frontend Dev Test</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!--[if lte IE 9]>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<![endif]-->

	<!-- FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Nunito:400,700" rel="stylesheet">
  
  	<!-- CSS -->
	<link rel="stylesheet" href="css/style.min.css" />
  
</head>

<body>

	<main class="main">

		<section class="section">

			<header class="section__header">

				<h1 class="title"><div class="logo">
					<svg xmlns="http://www.w3.org/2000/svg" viewBox="-269.1 242.6 72 76.3"><path d="M-197.1 259.4c0-2.7-.4-5.4-1.1-8.1-1-3.2-3.4-5.8-6.5-7-6.3-2.2-13.1-2.2-19.4 0-3.2 1.2-5.6 3.8-6.5 7-1.5 5.3-1.5 10.9 0 16.2 1 3.2 3.4 5.8 6.5 7 3.1 1.1 6.4 1.7 9.7 1.6 3.3 0 6.6-.6 9.7-1.6 3.2-1.2 5.6-3.8 6.5-7 .7-2.7 1.1-5.4 1.1-8.1zm-10.5 0c0 1.3-.2 2.7-.6 3.9-.5 1.7-2 3-3.8 3.4-1.7.3-3.4.3-5 0-1.8-.3-3.2-1.6-3.8-3.4-.8-2.6-.8-5.3 0-7.9.5-1.7 2-3 3.8-3.4 1.7-.3 3.4-.3 5 0 1.8.3 3.2 1.6 3.8 3.4.4 1.3.6 2.7.6 4m-27.9 43.9c1.5-5.3 1.5-10.9 0-16.2-1-3.2-3.4-5.8-6.5-7-6.3-2.2-13.1-2.2-19.4 0-3.2 1.2-5.6 3.8-6.5 7-1.5 5.3-1.5 10.9 0 16.2 1 3.2 3.4 5.8 6.5 7 6.3 2.2 13.1 2.2 19.4 0 3.1-1.1 5.6-3.7 6.5-7m-9.4-8c0 1.3-.2 2.7-.6 3.9-.5 1.7-2 3-3.8 3.4-1.7.3-3.4.3-5 0-1.8-.3-3.2-1.6-3.8-3.4-.8-2.6-.8-5.3 0-7.9.5-1.7 2-3 3.8-3.4 1.7-.3 3.4-.3 5 0 1.8.3 3.2 1.6 3.8 3.4.4 1.3.6 2.6.6 4m0-36h10.5c0-2.7-.4-5.4-1.1-8-1-3.2-3.4-5.8-6.5-7-6.3-2.2-13.1-2.2-19.4 0-3.2 1.2-5.6 3.8-6.5 7-1.5 5.3-1.5 10.9 0 16.2 1 3.2 3.4 5.8 6.5 7 3.1 1.1 6.4 1.6 9.7 1.6 3.3 0 6.6-.6 9.7-1.6 3.2-1.2 5.6-3.8 6.5-7 .1-.4.2-.9.4-1.4l-9.9-4.6c-.1.6-.2 1.2-.4 1.8-.5 1.7-2 3-3.8 3.4-1.7.3-3.4.3-5 0-1.8-.3-3.2-1.6-3.8-3.4-.8-2.6-.8-5.3 0-7.9.5-1.7 2-3 3.8-3.4 1.7-.3 3.4-.3 5 0 1.8.3 3.2 1.6 3.8 3.4.3 1.3.5 2.6.5 3.9m14.1 27.9c-.7 2.6-1.1 5.3-1.1 8.1V319h10.5v-23.7c0-1.3.2-2.7.6-3.9.5-1.7 2-3 3.8-3.4 1.7-.3 3.4-.3 5 0 1.8.3 3.2 1.6 3.8 3.4.8 2.6.8 5.3 0 7.9-.5 1.7-2 3-3.7 3.4-1.7.3-3.4.3-5 0-.3-.1-.7-.2-1-.3l3.6 9.8c3.3 0 6.6-.6 9.7-1.6 3.2-1.2 5.6-3.8 6.5-7 1.5-5.3 1.5-10.9 0-16.2-1-3.2-3.4-5.8-6.5-7-6.3-2.2-13.1-2.2-19.4 0-3.4 1-5.8 3.6-6.8 6.8"></path></svg>
				</div>

				Digital Frontend <br/>Dev Test</h1>

			</header><!--/.section__header-->

			<div class="section__content">
							
				<div class="donation">

					<div class="donation__main">

						<header class="donation__header">
						
							<h2>Help refugees rebuild their lives and communities in Manchester</h2>
							<h3>Manchester Refugee Support Network (MRSN)</h3>

						</header><!--/.donation__header-->

						<progress id="progress" class="progress" value="0" max="100">62%</progress>

						<div id="figures" class="table figures">
							<table>
								<thead>
									<th scope="col">Raised so far</th>
									<th scope="col">Target</th>
								</thead>
								<tbody>
									<td data-th="Raised so far">£<span id="raised"></span></td>
									<td data-th="Target">£<span id="target"></span></td>
								</tbody>
							</table>
						</div>

						<form id="frm-donate" class="form" data-success="Thanks, you helped us reach the target!" data-donate="Thanks for your donation!">
							<fieldset>
								
								<div class="form__group">
									<label>Donate to this project</label>
									<div class="form__row">
										<div class="input">
											<span class="input__addon">£</span>
											<input class="form__control" id="frm-donate__donation" type="number" min="1" step="1" value="" />
										</div>
										<button class="btn" type="submit">Donate</button>
									</div>
								</div>

							</fieldset>
						</form>

					</div><!--/.donation__main-->

					<footer class="donation__footer">
						
						<p><a href="#">Learn more about causes local to you</a></p>

					</footer><!--/.donation__footer-->

				</div><!--/.donation-->

			</div><!--/.section__content-->

		</section><!--/.section-->

	</main>

	<script>


	// update values from JSON

		var request = new XMLHttpRequest(),
			url = 'https://coop-mock-test-api.herokuapp.com/',
			raised = document.querySelector('#raised'),
			target = document.querySelector('#target'),
			progress = document.querySelector('#progress'),
			figures = document.querySelector('#figures'),
			raisedTotal = 0,
			raisedTarget = 0,
			progressPercentage = 0;

		var updateProgress = function() {
			
			// update total raised
			raised.innerText = raisedTotal.toLocaleString('en', {minimumFractionDigits: 2});

			// update progress
		    progressPercentage = (raisedTotal/raisedTarget)*100;
			progress.value = progressPercentage;

		}

		request.open('GET', url, true);

		request.onload = function() {
		  if (request.status >= 200 && request.status < 400) {
		    // Success!
		    
		    // get data
		    var data = JSON.parse(request.responseText);
		    
		    
		    // update totals

		    raisedTotal = data.raised;
		    raisedTarget = data.target;

		    target.innerText = raisedTarget.toLocaleString('en');

		    updateProgress();


		    // show dynamic figures
		    progress.classList.add('show');
		    figures.classList.add('show');

		  } else {
		    // We reached our target server, but it returned an error
		    console.log('error')
		  }
		};

		request.onerror = function() {
		  // There was a connection error of some sort
		  alert(' There was an error... do something')
		};

		// make request
		request.send();

	// submit form

		var form = document.getElementById('frm-donate'),
			input = document.getElementById('frm-donate__donation');

		var success = document.createElement('p'),
			successText = form.getAttribute('data-success'),
			donateText = form.getAttribute('data-donate');
		
		success.classList.add('success');
		success.id = 'success';

		if(form.addEventListener){
		    form.addEventListener('submit', function(e){
				e.preventDefault();

				var val = Number(input.value);

				if(val > 0) {

					raisedTotal = raisedTotal + val;

					raised.innerText = raisedTotal.toLocaleString('en', {minimumFractionDigits: 2});

				    // update progress
			    	updateProgress();

			    	if (progressPercentage >= 100) {	
			    		figures.classList.add('success');

			    		success.innerHTML = successText;

			    	} else {

			    		success.innerHTML = donateText;

			    	}
			    	
			    	if(!document.getElementById('success')) {
			    		success.appendAfter(figures);
			    	}

			    	input.value = '';

			    	console.log('submit form')

			    }

			});

			Element.prototype.appendAfter = function (element) {
				element.parentNode.insertBefore(this, element.nextSibling);
			},false;

		}

	</script>

</body>
</html>